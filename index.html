<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>é…ä¿¡è€… | OBS VirtualCam â†’ WebRTC</title>
</head>
<body style="background:#111;color:#eee;text-align:center;font-family:sans-serif;">
<h1>ğŸ¥ é…ä¿¡è€…ãƒšãƒ¼ã‚¸</h1>
<p>OBSã®ä»®æƒ³ã‚«ãƒ¡ãƒ©ã‚’ONã«ã—ã¦ã€Œé…ä¿¡é–‹å§‹ã€ã‚¯ãƒªãƒƒã‚¯</p>
<video id="local" autoplay playsinline style="width:80%;border-radius:12px;"></video>
<br>
<button id="startBtn">é…ä¿¡é–‹å§‹</button>

<script>
const ws = new WebSocket("wss://fancy-king-df6d.kawaguchigumi-0029.workers.dev/"); // â† ã‚ã¨ã§server.jsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸURLã«å¤‰æ›´
const pc = new RTCPeerConnection({ iceServers: [{urls:'stun:stun.l.google.com:19302'}] });
const video = document.getElementById('local');

ws.onmessage = async (e) => {
  const msg = JSON.parse(e.data);
  if (msg.answer) {
    await pc.setRemoteDescription(msg.answer);
  } else if (msg.candidate) {
    await pc.addIceCandidate(msg.candidate);
  }
};

document.getElementById('startBtn').onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
  stream.getTracks().forEach(track => pc.addTrack(track, stream));
  video.srcObject = stream;
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  ws.send(JSON.stringify({ offer }));
};

pc.onicecandidate = (e) => {
  if (e.candidate) ws.send(JSON.stringify({ candidate: e.candidate }));
};
</script>
</body>
</html>
