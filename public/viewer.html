<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¦–è´ç«¯æœ« // NieR StreamView</title>
<style>
  body {
    margin: 0;
    padding: 40px 20px;
    background: linear-gradient(160deg, #111, #000);
    font-family: 'Courier New', monospace;
    color: #ccc;
    text-align: center;
  }
  h1 { letter-spacing: 3px; text-shadow: 0 0 10px #888; font-weight: 300; }
  #remote {
    width: 90%;
    max-width: 800px;
    border: 1px solid #444;
    border-radius: 12px;
    background: #000;
    margin: 20px auto;
    box-shadow: 0 0 25px rgba(0,255,255,0.15);
  }
  button {
    background: #222;
    color: #ddd;
    border: 1px solid #666;
    padding: 12px 40px;
    margin: 8px;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: all .3s;
  }
  button:hover { background: #555; color: #fff; }
  #status { margin-top: 20px; font-size: 18px; color: #0ff; text-shadow: 0 0 8px #0ff; }
</style>
</head>
<body>
<h1>ğŸ“¡ NieR Stream Viewer</h1>
<video id="remote" autoplay playsinline></video>
<div id="status">æ¥ç¶šå¾…æ©Ÿä¸­...</div>
<button id="connectBtn">æ¥ç¶šé–‹å§‹</button>
<script>
const WS_URL = "wss://k-divenohtml.onrender.com";
const ICE_SERVERS = [{ urls: "stun:stun.l.google.com:19302" }];

let ws, pc;
const video = document.getElementById('remote');
const statusDiv = document.getElementById('status');

function updateStatus(t,c="#0ff"){statusDiv.textContent=t;statusDiv.style.color=c;statusDiv.style.textShadow=`0 0 10px ${c}`;}

function connect(){
  ws = new WebSocket(WS_URL);
  ws.onopen = () => {
    ws.send(JSON.stringify({ viewer: true }));
    updateStatus("é€šä¿¡å›ç·šï¼šONLINE");
  };
  ws.onmessage = async e => {
    const msg = JSON.parse(e.data);
    if (msg.broadcasterDisconnected){
      updateStatus("é…ä¿¡çµ‚äº†", "#f33");
      video.srcObject=null;
      return;
    }
    if (msg.offer){
      pc = new RTCPeerConnection({ iceServers: ICE_SERVERS });
      pc.ontrack = e => { video.srcObject = e.streams[0]; video.play().catch(()=>{}); updateStatus("è¦–è´ä¸­...", "#0f0"); };
      await pc.setRemoteDescription(msg.offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      ws.send(JSON.stringify({ answer }));
    }
    if (msg.candidate && pc) await pc.addIceCandidate(msg.candidate);
  };
  ws.onclose = () => updateStatus("é€šä¿¡åˆ‡æ–­", "#f33");
}
document.getElementById('connectBtn').onclick = connect;
</script>
</body>
</html>
