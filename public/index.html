<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é…ä¿¡è€…ç«¯æœ« // NieR LinkCast</title>
<style>
  body {
    margin: 0;
    padding: 40px 20px;
    font-family: 'Courier New', monospace;
    background: radial-gradient(circle at 30% 30%, #222, #000);
    color: #dcdcdc;
    text-align: center;
  }
  h1 {
    font-weight: 300;
    letter-spacing: 3px;
    text-shadow: 0 0 10px #999;
  }
  #local {
    width: 90%;
    max-width: 800px;
    border: 1px solid #555;
    border-radius: 12px;
    background: #000;
    margin: 20px auto;
    box-shadow: 0 0 25px rgba(255,255,255,0.1);
  }
  button {
    background: #333;
    color: #ddd;
    border: 1px solid #777;
    padding: 12px 40px;
    margin: 8px;
    border-radius: 6px;
    font-size: 16px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  button:hover:not(:disabled) { background: #666; color: #fff; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #stopBtn { border-color: #a33; }
  #status {
    margin: 20px auto;
    padding: 10px 20px;
    border-radius: 8px;
    display: inline-block;
    font-weight: bold;
    color: #0f0;
    text-shadow: 0 0 10px #0f0;
  }
</style>
</head>
<body>
<h1>ğŸ¥ NieR Broadcast Terminal</h1>
<div id="status">å¾…æ©Ÿä¸­...</div>
<video id="local" autoplay playsinline muted></video>
<div>
  <button id="startBtn">é…ä¿¡é–‹å§‹</button>
  <button id="stopBtn" disabled>åœæ­¢</button>
</div>
<script>
const WS_URL = "wss://k-divenohtml.onrender.com";
const ICE_SERVERS = [{ urls: "stun:stun.l.google.com:19302" }];

let ws, pc, localStream;

const statusDiv = document.getElementById('status');
const video = document.getElementById('local');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');

function updateStatus(text, color="#0f0") {
  statusDiv.textContent = text;
  statusDiv.style.color = color;
  statusDiv.style.textShadow = `0 0 10px ${color}`;
}

function connectWS() {
  ws = new WebSocket(WS_URL);
  ws.onopen = () => updateStatus("é€šä¿¡å›ç·šï¼šONLINE");
  ws.onmessage = async (e) => {
    const msg = JSON.parse(e.data);
    if (msg.answer && pc) await pc.setRemoteDescription(msg.answer);
    if (msg.candidate && pc) await pc.addIceCandidate(msg.candidate);
  };
  ws.onclose = () => updateStatus("é€šä¿¡å›ç·šï¼šOFFLINE", "#f33");
}

async function start() {
  updateStatus("ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...");
  localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
  video.srcObject = localStream;
  pc = new RTCPeerConnection({ iceServers: ICE_SERVERS });
  localStream.getTracks().forEach(t => pc.addTrack(t, localStream));
  pc.onicecandidate = e => e.candidate && ws.send(JSON.stringify({ candidate: e.candidate }));
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  ws.send(JSON.stringify({ offer }));
  updateStatus("é…ä¿¡ä¸­...", "#0ff");
  startBtn.disabled = true;
  stopBtn.disabled = false;
}

function stop() {
  if (localStream) localStream.getTracks().forEach(t => t.stop());
  if (pc) pc.close();
  ws.send(JSON.stringify({ stop: true }));
  updateStatus("åœæ­¢ä¸­...", "#aaa");
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

startBtn.onclick = start;
stopBtn.onclick = stop;
connectWS();
</script>
</body>
</html>
